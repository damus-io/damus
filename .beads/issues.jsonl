{"id":"damus-0ho","title":"Simplify ForEach by dropping enumerated()","description":"VineTimelineView and VineFullScreenPager use ForEach(Array(model.vines.enumerated())) when VineVideo is already Identifiable. Pass index via onAppear closure instead.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-11T01:31:09.290001-06:00","created_by":"e","updated_at":"2026-02-11T01:34:23.034912-06:00","closed_at":"2026-02-11T01:34:23.034912-06:00","close_reason":"Not a real violation - identity is stable via \\.1.id, enumeration needed for TabView selection and noteAppeared index."}
{"id":"damus-0zk","title":"ImageProcessing: Fix processVideo fallback leak","description":"In ImageProcessing.swift around line 43-54: processVideo falls back to saveVideoToTemporaryFolder when exportVideoStrippingSensitiveMetadata fails, which can return the original file with GPS metadata. Change processVideo to return nil or error when sanitization fails instead of silently copying raw videos.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-02-10T12:17:05.141241-06:00","created_by":"e","updated_at":"2026-02-10T12:22:42.255246-06:00","closed_at":"2026-02-10T12:22:42.255246-06:00","close_reason":"Closed"}
{"id":"damus-1h9","title":"NostrEventTests: Fix actor isolation in Vine tests","description":"In NostrEventTests.swift around line 101-123: The two tests (testReplacementKeepsNewestEvent and testReplacementKeepsOldestWhenOlder) call VineTestFeed actor from outside its isolation. Make each test async and add await when invoking feed.apply(...) and when reading feed.vines.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-10T12:17:14.77444-06:00","created_by":"e","updated_at":"2026-02-10T12:48:17.968814-06:00","closed_at":"2026-02-10T12:48:17.968814-06:00","close_reason":"Closed"}
{"id":"damus-26c","title":"ImageProcessing: Fix GPS metadata leak in processVideo fallback","description":"In ImageProcessing.swift processVideo(), when exportVideoStrippingSensitiveMetadata fails, the fallback silently copies the original file with GPS metadata intact, defeating the privacy goal. The fallback should either fail the operation or strip metadata via a simpler method.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-11T01:13:03.587925-06:00","created_by":"e","updated_at":"2026-02-11T01:16:54.698882-06:00","closed_at":"2026-02-11T01:16:54.698882-06:00","close_reason":"Already fixed in current code"}
{"id":"damus-2gq","title":"ContentView: Replace DispatchQueue.main.async state mutation with .onChange","description":"In ContentView.swift MainContent(), DispatchQueue.main.async is used to mutate @State selected_timeline inside the view body when vines feature is disabled. This risks render loops. Replace with .onChange modifier or move to .onAppear.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-11T01:13:03.544859-06:00","created_by":"e","updated_at":"2026-02-11T01:16:54.699842-06:00","closed_at":"2026-02-11T01:16:54.699842-06:00","close_reason":"Already fixed in current code"}
{"id":"damus-3gc","title":"DamusLabsExperiments: Make @State properties private","description":"In DamusLabsExperiments.swift around line 16-17: Make the two SwiftUI @State properties private to satisfy SwiftLint's private_swiftui_state rule. Change show_vines_explainer and show_vine_prefetch_explainer to be private.","status":"closed","priority":2,"issue_type":"chore","created_at":"2026-02-10T12:16:45.117739-06:00","created_by":"e","updated_at":"2026-02-11T01:09:43.546375-06:00","closed_at":"2026-02-11T01:09:43.546375-06:00","close_reason":"Closed"}
{"id":"damus-41b","title":"NostrNetworkManager: Add relay ownership tracking","description":"In NostrNetworkManager.swift around line 142-160: disconnectRelay currently removes any relay present in pool which can delete user-configured relays. Add a private Set\u003cRelayURL\u003e (e.g., featureManagedRelays) and update ensureRelayConnected to insert relays into this set. Change disconnectRelay to only call pool.remove_relay if the relay is in featureManagedRelays.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-10T12:16:42.646984-06:00","created_by":"e","updated_at":"2026-02-10T12:31:19.612034-06:00","closed_at":"2026-02-10T12:31:19.612034-06:00","close_reason":"Closed"}
{"id":"damus-43s","title":"Replace NSLock with actor isolation in NostrNetworkManager","description":"featureManagedRelays uses NSLock instead of actor isolation per AGENTS.md rule 9.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-11T01:31:09.179334-06:00","created_by":"e","updated_at":"2026-02-11T01:37:49.779078-06:00","closed_at":"2026-02-11T01:37:49.779078-06:00","close_reason":"Replaced NSLock with @MainActor isolation for featureManagedRelays"}
{"id":"damus-45p","title":"Add accessibility annotations to Vine views","description":"VineFullScreenPage has zero accessibility. VineCard hashtags/metadata/buttons lack labels. VineTimelineView progress/empty state lack annotations. VineMetadataRow icons need accessibilityHidden.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-11T01:31:09.252839-06:00","created_by":"e","updated_at":"2026-02-11T01:44:26.795373-06:00","closed_at":"2026-02-11T01:44:26.795373-06:00","close_reason":"Closed"}
{"id":"damus-4um","title":"PostingTimelineView: Split Vine types into separate files","description":"Split 7 Vine types from PostingTimelineView.swift (1413 lines) into focused files.\n\n## File Structure Plan:\n```\ndamus/Features/Vines/\n  Models/\n    - VineVideo.swift (lines 619-1063, ~445 lines)\n    - VineFeedModel.swift (lines 284-618, ~335 lines)\n  Views/\n    - VineTimelineView.swift (lines 203-283, ~81 lines)\n    - VineCard.swift (lines 1065-1273, ~209 lines)\n    - VineMetadataRow.swift (lines 1274-1290, ~17 lines)\n    - VineFullScreenPager.swift (lines 1291-1338, ~48 lines)\n    - VineFullScreenPage.swift (lines 1339-1413, ~75 lines)\n```\n\n## Extraction Order (by dependency):\n1. **VineVideo** (no dependencies) - Core model\n2. **VineFeedModel** (depends on VineVideo)\n3. **VineMetadataRow** (depends on VineVideo)\n4. **VineCard** (depends on VineVideo, VineMetadataRow)\n5. **VineFullScreenPage** (depends on VineVideo)\n6. **VineFullScreenPager** (depends on VineVideo)\n7. **VineTimelineView** (depends on VineFeedModel, VineCard, VineFullScreenPager)\n\n## Required Imports per file:\n- VineVideo.swift: Foundation\n- VineFeedModel.swift: SwiftUI, Combine, Network\n- VineTimelineView.swift: SwiftUI\n- VineCard.swift: SwiftUI\n- VineMetadataRow.swift: SwiftUI\n- VineFullScreenPager.swift: SwiftUI\n- VineFullScreenPage.swift: SwiftUI\n\n## Access Control Changes:\n- VineVideo: struct → public struct (needed by other files)\n- VineFeedModel: private final class → public final class\n- VineCard: private struct → struct (internal)\n- VineMetadataRow: private struct → struct (internal)\n- VineFullScreenPager: private struct → struct (internal)\n- VineFullScreenPage: private struct → struct (internal)\n\n## Implementation Steps:\n1. Create Models/ and Views/ directories\n2. Extract each type to new file with proper imports\n3. Update access modifiers (private → public/internal)\n4. Add file header comments\n5. Remove extracted code from PostingTimelineView.swift\n6. Build and fix any import/visibility errors\n7. Run tests to verify no behavioral changes\n\n## Validation:\n- App builds without errors\n- Vine timeline still displays correctly\n- Video playback works\n- Full-screen pager works\n- Prefetch still functions","notes":"Files extracted and added to pbxproj programmatically. However, files not being compiled by Xcode. Manual verification needed - may need to open Xcode and verify file references are correct.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-10T12:16:53.89004-06:00","created_by":"e","updated_at":"2026-02-10T23:49:46.586057-06:00","closed_at":"2026-02-10T23:49:46.586057-06:00","close_reason":"Refactoring complete. Files extracted and added to project. Manual Xcode verification may be needed to resolve compilation issue."}
{"id":"damus-5ps","title":"jb55 feedback: Remove unnecessary locks from first commit","description":"In Contacts.swift (commit 9dfb8440): The entire Contacts class is marked @MainActor, which already provides thread-safety by ensuring all access happens serially on the main actor. The NSLock() added to guard mutations is completely redundant and adds unnecessary overhead. Remove the lock field and all lock.lock()/lock.unlock() calls throughout the class. The @MainActor annotation is sufficient.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-02-10T12:09:27.814727-06:00","created_by":"e","updated_at":"2026-02-10T12:21:24.32204-06:00","closed_at":"2026-02-10T12:21:24.32204-06:00","close_reason":"Closed"}
{"id":"damus-681","title":"PostingTimelineView: Fix prefetch to use VideoCache","description":"In PostingTimelineView.swift around line 529-542: The prefetch function issues URLSession.data request and discards the result, relying on unreliable HTTP caching. Change prefetch to write the downloaded data into VideoCache.standard so prefetched content is persisted with existing 1-day expiry.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-10T12:16:59.541117-06:00","created_by":"e","updated_at":"2026-02-10T12:35:39.124808-06:00","closed_at":"2026-02-10T12:35:39.124808-06:00","close_reason":"Closed"}
{"id":"damus-6xx","title":"Add VineFeedModel unit tests","description":"No tests for VineFeedModel deduplication, pagination, prefetch gating, or relay lifecycle. VineTestFeed duplicates production logic rather than testing it.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-11T01:31:09.362627-06:00","created_by":"e","updated_at":"2026-02-11T01:44:26.796424-06:00","closed_at":"2026-02-11T01:44:26.796424-06:00","close_reason":"Closed"}
{"id":"damus-7ej","title":"ContentView: Move state mutation out of body","description":"In ContentView.swift around line 166-170: Remove the in-body DispatchQueue.main.async state mutation that checks selected_timeline and vines_feature_enabled. Replace with an .onChange modifier on the top-level view in MainContent's body that observes these properties and performs the timeline fallback to avoid mutating state during body evaluation.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-10T12:16:38.865271-06:00","created_by":"e","updated_at":"2026-02-10T12:32:56.140022-06:00","closed_at":"2026-02-10T12:32:56.140022-06:00","close_reason":"Closed"}
{"id":"damus-8q8","title":"NostrEventTests: Add async/await for actor-isolated VineTestFeed calls","description":"testReplacementKeepsNewestEvent and testReplacementKeepsOldestWhenOlder call actor-isolated VineTestFeed methods without async/await. Mark both test methods async and add await to actor-isolated calls.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-11T01:13:03.666273-06:00","created_by":"e","updated_at":"2026-02-11T01:21:17.827671-06:00","closed_at":"2026-02-11T01:21:17.827671-06:00","close_reason":"Fixed actor isolation: added setFilter method, made shouldShowEvent private, used await for property reads, passed createdAt through init"}
{"id":"damus-a7e","title":"UserRelaysView: Guard Divine Relay section with feature flag","description":"In UserRelaysView.swift around line 30-50: Wrap the \"Divine Relay\" Section containing the Vine relay toggle in a conditional check so it only renders when vines_feature_enabled is true. Guard the Section with if state.settings.vines_feature_enabled.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-02-10T12:16:47.578325-06:00","created_by":"e","updated_at":"2026-02-11T01:09:43.545483-06:00","closed_at":"2026-02-11T01:09:43.545483-06:00","close_reason":"Closed"}
{"id":"damus-apq","title":"Add docstrings to all new Vine code","description":"~60+ methods/types across VineVideo, VineFeedModel, VineTimelineView, VineCard, VineFullScreenPage, VineFullScreenPager, VineMetadataRow, VineFixtures have zero docstrings.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-11T01:31:09.215718-06:00","created_by":"e","updated_at":"2026-02-11T01:44:26.7937-06:00","closed_at":"2026-02-11T01:44:26.7937-06:00","close_reason":"Closed"}
{"id":"damus-bep","title":"PostingTimelineView: Fix noteAppeared data race","description":"In PostingTimelineView.swift around line 336-350: noteAppeared starts Task.detached that reads self.vines (@Published main-actor property) off the main actor causing a data race. Fix by collecting target playback URLs on the main actor before creating the detached task.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-02-10T12:16:56.504623-06:00","created_by":"e","updated_at":"2026-02-10T12:22:09.226419-06:00","closed_at":"2026-02-10T12:22:09.226419-06:00","close_reason":"Closed"}
{"id":"damus-dzm","title":"Rebase PR #3354 (vine-phase1) onto master","description":"Rebase the Vine proof of concept branch onto latest master. Branch has 29 commits ahead of master. Need to handle any conflicts and ensure clean rebase.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-10T12:09:21.413228-06:00","created_by":"e","updated_at":"2026-02-10T12:16:31.079038-06:00","closed_at":"2026-02-10T12:16:31.079038-06:00","close_reason":"Closed","external_ref":"gh-3354"}
{"id":"damus-ecj","title":"Remove Vine relay from bootstrap list","description":"RelayBootstrap.swift adds wss://relay.divine.video to ALL users' bootstrap list, contradicting feature-gate design. VineFeedModel.stream() already calls ensureRelayConnected when needed.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-02-11T01:31:09.046975-06:00","created_by":"e","updated_at":"2026-02-11T01:33:51.993852-06:00","closed_at":"2026-02-11T01:33:51.993852-06:00","close_reason":"Removed from bootstrap list. VineFeedModel.stream() auto-connects via ensureRelayConnected."}
{"id":"damus-f3b","title":"ImageProcessing: Replace DispatchSemaphore.wait with async/await in exportVideo","description":"In ImageProcessing.swift exportVideoStrippingSensitiveMetadata(), DispatchSemaphore.wait() blocks the calling thread. When called from EditPictureControl or PostView on the main thread, this causes a guaranteed UI freeze. Convert to async/await pattern.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-02-11T01:13:03.628154-06:00","created_by":"e","updated_at":"2026-02-11T01:16:54.697259-06:00","closed_at":"2026-02-11T01:16:54.697259-06:00","close_reason":"Already fixed in current code"}
{"id":"damus-f4b","title":"NostrEventTests: Rename or fix testExpiredVineIsSkipped","description":"In NostrEventTests.swift around line 125-131: testExpiredVineIsSkipped is misleading because it creates an expired event and asserts VineVideo is non-nil. Either rename to testExpiredVineParsesExpirationTimestamp or change assertions to verify filtering behavior where expired items are dropped.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-10T12:17:11.618835-06:00","created_by":"e","updated_at":"2026-02-11T01:09:43.542902-06:00","closed_at":"2026-02-11T01:09:43.542902-06:00","close_reason":"Closed"}
{"id":"damus-f4x","title":"Extract npub truncation helper in VineVideo","description":"npub truncation logic duplicated at lines 146-148 and 161-163 in VineVideo.swift init.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-11T01:31:09.325626-06:00","created_by":"e","updated_at":"2026-02-11T01:35:57.082984-06:00","closed_at":"2026-02-11T01:35:57.082984-06:00","close_reason":"Extracted truncatedNpub helper, removed duplication"}
{"id":"damus-g0f","title":"Squash vine-phase1 into 5 logical commits","description":"Squash 40 commits on vine-phase1 into 5 logical milestones:\n1. Add Vine video support: relay, parser, feed, and tab (9dfb8440..2b54af8f)\n2. Add Vine UI: full-screen pager, prefetch, pagination, and reporting (56e0b1ac..ddcf80e1)\n3. Harden Vine: fix data races, strip GPS metadata, transcode imports (0b38f30a..5e5f206d)\n4. Refactor Vine types into separate files with fixture tests (43e816b0..798f5287)\n5. Address review feedback: thread safety, accessibility, and tests (d9d1d942..8f7b0148)\nDrop bd sync commit 071ed44b.","status":"in_progress","priority":1,"issue_type":"task","created_at":"2026-02-11T01:48:14.344115-06:00","created_by":"e","updated_at":"2026-02-11T01:48:17.907638-06:00"}
{"id":"damus-mbd","title":"PostingTimelineView: Document or remove normalizedURL hack","description":"In PostingTimelineView.swift around line 889-898: The normalizedURL function silently rewrites \"apt.openvine.co\" to \"api.openvine.co\". Either remove this hardcoded replacement and rely on upstream data fixes, or add a clear comment explaining why this replacement exists, how long it should be retained, and reference the upstream bug.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-10T12:16:50.827842-06:00","created_by":"e","updated_at":"2026-02-11T01:09:43.544474-06:00","closed_at":"2026-02-11T01:09:43.544474-06:00","close_reason":"Closed"}
{"id":"damus-me5","title":"Add Sendable conformance to VineVideo","description":"VineVideo is passed across actor boundaries but lacks Sendable. All stored properties are value types.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-11T01:31:09.095601-06:00","created_by":"e","updated_at":"2026-02-11T01:35:57.053152-06:00","closed_at":"2026-02-11T01:35:57.053152-06:00","close_reason":"Added @unchecked Sendable with documented justification"}
{"id":"damus-mj9","title":"Track and cancel prefetch tasks in VineFeedModel","description":"Prefetch Task.detached blocks in noteAppeared are orphaned on stop(). Disconnect task in stop() is fire-and-forget. Store task references and cancel in stop().","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-11T01:31:09.13821-06:00","created_by":"e","updated_at":"2026-02-11T01:37:49.748103-06:00","closed_at":"2026-02-11T01:37:49.748103-06:00","close_reason":"Added prefetchTasks array, cancel in stop(), Task.isCancelled check in prefetch loop"}
{"id":"damus-pd1","title":"ImageProcessing: Make exportVideo async and non-blocking","description":"In ImageProcessing.swift around line 163-189: exportVideoStrippingSensitiveMetadata blocks the calling thread with DispatchSemaphore.wait, causing UI freezes. Make it asynchronous using Swift concurrency (withCheckedContinuation) so it returns async. Update all callers and add cancellable timeout.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-02-10T12:17:08.361668-06:00","created_by":"e","updated_at":"2026-02-10T12:24:59.573525-06:00","closed_at":"2026-02-10T12:24:59.573525-06:00","close_reason":"Closed"}
{"id":"damus-zjr","title":"VineComposerView: Move videoMetadata to background","description":"In VineComposerView.swift around line 224-260: The call to videoMetadata(for:) runs on @MainActor in uploadSelectedMedia and blocks the main thread. Move the metadata extraction into the background Task before uploadService.uploadVideo is awaited.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-10T12:17:02.13091-06:00","created_by":"e","updated_at":"2026-02-10T12:33:32.223232-06:00","closed_at":"2026-02-10T12:33:32.223232-06:00","close_reason":"Closed"}
