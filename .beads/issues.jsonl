{"id":"damus-02i","title":"Automate poor connectivity tests for all other app flows","description":"Investigate and implement automated testing for non-upload app flows under poor network conditions. This covers relay connections, event fetching, profile loading, etc.\n\nAreas to cover:\n- Relay connection/reconnection under packet loss\n- Event fetching with high latency\n- Profile/metadata loading with intermittent connectivity\n- Timeline scrolling during network degradation\n- DM sending/receiving with poor connectivity\n- Zap flows under network stress\n\nQuestions to answer:\n- Can we mock WebSocket connections for relay testing?\n- How do we test graceful degradation of the UI?\n- Should we create a test harness that wraps network calls?\n- Can we leverage existing Ndb test infrastructure?\n\nDepends on learnings from: damus-2qb (media upload automation)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-03T14:31:04.329626-06:00","created_by":"e","updated_at":"2026-01-03T14:31:04.329626-06:00","labels":["automation","network testing"]}
{"id":"damus-0pj","title":"Code Requirements for Image Upload Fixes","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-03T12:46:37.113908-06:00","created_by":"e","updated_at":"2026-01-03T12:46:37.113908-06:00","labels":["documentation","standards"],"comments":[{"id":1,"issue_id":"damus-0pj","author":"e","text":"## Code Requirements\n\nAll implementation work for image upload fixes must follow these standards:\n\n### 1. Logically Distinct Commits\n- Each commit should address ONE logical change\n- Don't mix refactoring with bug fixes\n- Don't mix feature additions with cleanup\n\n### 2. Standalone Commits  \n- Each commit must be independently revertable\n- No commit should create dependencies that break if removed\n- Design for easy cherry-picking or reverting tens of commits later\n\n### 3. Human Readable \u0026 Reviewable Code\n- Code must be clear and understandable by human reviewers\n- Avoid clever/obscure patterns - prefer explicit over implicit\n- Before proposing changes, analyze if nostrdb upgrades would benefit the change\n\n### 4. Docstring Coverage\n- All new functions must have docstrings explaining purpose, parameters, return values\n- All modified functions must have updated docstrings if behavior changes\n- Document non-obvious logic inline\n\n### 5. Performance Requirements\n- No bottlenecks or performance regressions\n- Profile any code that runs on main thread\n- Consider async/background execution for heavy operations\n- Document any performance considerations in code comments\n\n---\n\nThese requirements apply to all linked beads.","created_at":"2026-01-03T18:46:48Z"}]}
{"id":"damus-2qb","title":"Automate poor connectivity tests for media upload flow","description":"Investigate and implement automated testing for media uploads under poor network conditions. Currently we have unit tests with MockURLProtocol, but need to explore integration/UI testing approaches.\n\nQuestions to answer:\n- Can XCUITest simulate network conditions programmatically?\n- Should we use a local proxy (Charles, mitmproxy) for more realistic simulation?\n- Can we trigger Network Link Conditioner profiles from test code?\n- What about testing partial uploads / resume after reconnection?\n- How do we test the UI feedback (progress indicators, error messages) under poor network?\n\nRelated: Unit tests exist in UploadRetryTests.swift using MockURLProtocol","notes":"Implemented NetworkConditionSimulator for UI testing. Added example tests and documentation in DEV_TIPS.md. Supports timeout, connectionLost, notConnected, slowNetwork, failThenSucceed, and serverError conditions via launch arguments.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T14:30:51.875782-06:00","created_by":"e","updated_at":"2026-01-03T14:55:25.64149-06:00","closed_at":"2026-01-03T14:55:25.641492-06:00","labels":["automation","media upload","network testing"]}
{"id":"damus-3n4","title":"MEDIUM: MediaPicker failedCount race condition - use serial queue or main thread for thread safety","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T17:01:11.732899-06:00","created_by":"e","updated_at":"2026-01-03T17:04:18.167195-06:00","closed_at":"2026-01-03T17:04:18.167195-06:00","close_reason":"Added DispatchQueue.main.async for thread safety"}
{"id":"damus-3qq","title":"TESTING: Add unit test for 4xx don't-retry behavior in UploadRetryTests","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T17:22:49.226504-06:00","created_by":"e","updated_at":"2026-01-03T18:04:38.961339-06:00","closed_at":"2026-01-03T18:04:38.961339-06:00","close_reason":"fixed"}
{"id":"damus-5xd","title":"Add automated tests for upload fixes - HEIC, TSan, media picker","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-03T18:09:57.681549-06:00","created_by":"e","updated_at":"2026-01-03T18:09:57.681549-06:00"}
{"id":"damus-63x","title":"Propagate server error messages in getMediaURL() instead of returning nil","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:45:04.739442-06:00","created_by":"e","updated_at":"2026-01-03T12:53:57.312452-06:00","closed_at":"2026-01-03T12:53:57.312452-06:00","close_reason":"Closed","labels":["bug","error-handling","media"],"dependencies":[{"issue_id":"damus-63x","depends_on_id":"damus-tah","type":"relates-to","created_at":"2026-01-03T12:45:45.299497-06:00","created_by":"daemon"},{"issue_id":"damus-63x","depends_on_id":"damus-uya","type":"relates-to","created_at":"2026-01-03T12:45:45.322675-06:00","created_by":"daemon"},{"issue_id":"damus-63x","depends_on_id":"damus-r77","type":"relates-to","created_at":"2026-01-03T12:45:45.344668-06:00","created_by":"daemon"},{"issue_id":"damus-63x","depends_on_id":"damus-0pj","type":"parent-child","created_at":"2026-01-03T12:47:07.207933-06:00","created_by":"daemon"}],"comments":[{"id":2,"issue_id":"damus-63x","author":"e","text":"In MediaUploader.swift:117-120, when server returns error status with message, the message is only printed to console and nil is returned. This causes all server errors (rate limits, file size limits, auth failures) to show generic 'Error uploading image :(' instead of actual message.\n\nFix: Change getMediaURL() to return Result\u003cString, UploadError\u003e instead of String?\n\nRelated GitHub issues: #3484, #1286\nFiles: MediaUploader.swift, AttachMediaUtility.swift","created_at":"2026-01-03T18:45:31Z"},{"id":3,"issue_id":"damus-63x","author":"e","text":"## Implementation Complete\n\n### Changes Made:\n\n**1. MediaUploader.swift**\n- Added `UploadError` enum with typed error cases:\n  - `.serverError(message:)` - captures server error messages\n  - `.jsonParsingFailed` - response parsing failures\n  - `.missingURL` - no URL in response\n  - `.networkError(underlying:)` - network failures\n  - `.fileReadError(underlying:)` - file access issues\n  - `.invalidAPIURL` - malformed API URL\n  - `.noMediaData` - missing media data\n- Added `userMessage` property for localized user-facing messages\n- Changed `getMediaURL()` from `String?` to `Result\u003cString, UploadError\u003e`\n\n**2. AttachMediaUtility.swift**\n- Changed `ImageUploadResult.failed` from `Error?` to `UploadError`\n- All failure paths now use typed errors\n- Added comprehensive docstrings\n\n**3. ImageUploadModel.swift**\n- Updated to handle `UploadError` type\n- Cancellation detection now checks inside `.networkError`\n\n**4. PostView.swift**\n- Now displays `error.userMessage` instead of generic string\n- Removed generic \"Error uploading image :(\" fallback\n\n**5. EditPictureControl.swift**\n- Now displays actual error message from server\n- Added docstring\n\n### Result:\nUsers will now see actual error messages like:\n- \"File size exceeds 25MB limit\" (server error)\n- \"The network connection was lost\" (network error)\n- \"Failed to read file: ...\" (file error)\n\nInstead of: \"Error uploading image :(\"","created_at":"2026-01-03T18:53:53Z"}]}
{"id":"damus-8su","title":"TESTING: UI tests only verify app launches - should exercise upload and assert error/progress UI","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-03T17:01:11.847426-06:00","created_by":"e","updated_at":"2026-01-03T17:01:11.847426-06:00"}
{"id":"damus-an6","title":"Poor connection simulation testing for entire app (after image upload testing validated)","notes":"Superseded by damus-2qb (media upload) and damus-02i (all other flows). Media upload testing implemented with NetworkConditionSimulator.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:45:05.269054-06:00","created_by":"e","updated_at":"2026-01-03T14:55:31.569252-06:00","closed_at":"2026-01-03T14:55:31.569255-06:00","labels":["network","testing"],"dependencies":[{"issue_id":"damus-an6","depends_on_id":"damus-k5j","type":"blocks","created_at":"2026-01-03T12:45:38.52696-06:00","created_by":"daemon"},{"issue_id":"damus-an6","depends_on_id":"damus-0pj","type":"parent-child","created_at":"2026-01-03T12:47:07.214163-06:00","created_by":"daemon"}],"comments":[{"id":4,"issue_id":"damus-an6","author":"e","text":"After validating poor connection testing works for image uploads (damus-k5j), expand testing to cover:\n- Relay connections\n- Profile loading\n- Note fetching\n- Zaps/Lightning\n- DMs\n\nUse Network Link Conditioner or similar to simulate various network conditions app-wide.","created_at":"2026-01-03T18:45:32Z"}]}
{"id":"damus-czv","title":"Extend NetworkConditionSimulator to WebSocket/relay connections","description":"Extend the NetworkConditionSimulator infrastructure to support WebSocket connections used by Nostr relays.\n\nCurrent state:\n- NetworkConditionSimulator intercepts URLSession (HTTP/HTTPS) requests\n- Works well for media uploads to services like nostr.build\n- Does NOT intercept WebSocket connections\n\nChallenge:\n- Nostr uses WSS (WebSocket Secure) for all relay communication\n- URLProtocol only intercepts HTTP, not WebSocket\n- Need different approach for WebSocket simulation\n\nPossible approaches:\n1. **Mock at RelayConnection level** - Inject mock relay connections that simulate failures\n2. **Proxy approach** - Route WebSocket through local proxy that introduces failures\n3. **NWConnection interception** - If using Network.framework, may be interceptable\n4. **Launch argument + app-side mock** - Similar pattern but at WebSocket layer\n\nAreas to test:\n- Relay connection failures\n- Relay disconnection during event fetch\n- Reconnection behavior after network recovery\n- Subscription handling during intermittent connectivity\n- Event publishing under poor network\n\nRelated:\n- damus-2qb: NetworkConditionSimulator for HTTP (completed)\n- damus-02i: Poor connectivity tests for all app flows","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-03T15:02:47.772979-06:00","created_by":"e","updated_at":"2026-01-03T15:02:47.772979-06:00","labels":["automation","network testing","relay","websocket"]}
{"id":"damus-deu","title":"MEDIUM: 5xx with NIP-96 error body returns non-retryable .serverError - should be retryable","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T17:22:49.033865-06:00","created_by":"e","updated_at":"2026-01-03T18:04:38.908446-06:00","closed_at":"2026-01-03T18:04:38.908446-06:00","close_reason":"fixed"}
{"id":"damus-ewa","title":"MEDIUM: Retry logic should not retry 4xx HTTP errors - map to non-retryable UploadError, keep 5xx retryable","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T17:01:11.623726-06:00","created_by":"e","updated_at":"2026-01-03T17:04:18.143153-06:00","closed_at":"2026-01-03T17:04:18.143153-06:00","close_reason":"Added httpError case and 4xx status code check"}
{"id":"damus-f5k","title":"Add debug logging for image upload pipeline","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:45:05.078621-06:00","created_by":"e","updated_at":"2026-01-03T13:00:58.944307-06:00","closed_at":"2026-01-03T13:00:58.944307-06:00","close_reason":"Closed","labels":["debugging","enhancement","media"],"dependencies":[{"issue_id":"damus-f5k","depends_on_id":"damus-0pj","type":"parent-child","created_at":"2026-01-03T12:47:07.211686-06:00","created_by":"daemon"}],"comments":[{"id":5,"issue_id":"damus-f5k","author":"e","text":"Add structured logging throughout upload pipeline to aid debugging:\n\n1. Log raw server response when upload fails\n2. Log security scoped resource access success/failure\n3. Log image processing steps and failures\n4. Log file sizes, mime types, URLs\n\nUse existing Log utility with .image_uploading category.\n\nFiles: AttachMediaUtility.swift, MediaUploader.swift, MediaPicker.swift, ImageProcessing.swift","created_at":"2026-01-03T18:45:31Z"},{"id":6,"issue_id":"damus-f5k","author":"e","text":"## Implementation Complete\n\n### Logging added to 3 files:\n\n**1. AttachMediaUtility.swift**\n- Upload start: type, mime, API URL\n- NIP-98 auth header addition\n- File read errors\n- File size (KB/MB)\n- HTTP response status and size\n- Success URL or failure reason\n- Network errors\n\n**2. MediaUploader.swift**\n- Raw response body (first 500 chars)\n- Response status\n- JSON parsing errors\n- Server error messages\n- Missing URL tag errors\n\n**3. MediaPicker.swift**\n- Selection count\n- Image/video loading errors\n- GIF processing\n- Security scoped resource access/denial\n- Fallback processing success/failure\n- Processing completion count\n\n### Log Category\nAll logs use `.image_uploading` category for filtering in Console.app\n\n### Example log output:\n```\n[image_uploading] Starting upload: type=image, mime=image/jpg, api=https://nostr.build/...\n[image_uploading] Media file size: 1234.56 KB (1.21 MB)\n[image_uploading] Upload response: HTTP 200, size=456 bytes\n[image_uploading] Upload successful: https://nostr.build/...\n```\n\nOr on failure:\n```\n[image_uploading] Upload response: HTTP 413, size=89 bytes\n[image_uploading] Server returned error: File size exceeds limit\n[image_uploading] Upload failed: File size exceeds limit\n```","created_at":"2026-01-03T19:00:54Z"}]}
{"id":"damus-fsj","title":"HIGH: Fix potential crash in NetworkConditionSimulator timeout closure - weak self force unwrap after 2s delay can crash if deallocated","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-03T17:01:11.512368-06:00","created_by":"e","updated_at":"2026-01-03T17:04:18.119222-06:00","closed_at":"2026-01-03T17:04:18.119222-06:00","close_reason":"Fixed with guard let self = self else { return }"}
{"id":"damus-k5j","title":"Add poor/intermittent network connectivity testing for image uploads","notes":"Added MockURLProtocol, RetryTestURLProtocol, 18 unit tests for retry logic, and Network Link Conditioner documentation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:44:27.819548-06:00","created_by":"e","updated_at":"2026-01-03T14:30:10.699445-06:00","closed_at":"2026-01-03T14:30:10.699448-06:00","labels":["media","network","testing"],"dependencies":[{"issue_id":"damus-k5j","depends_on_id":"damus-0pj","type":"parent-child","created_at":"2026-01-03T12:47:07.21328-06:00","created_by":"daemon"}],"comments":[{"id":7,"issue_id":"damus-k5j","author":"e","text":"Testing scenarios needed:\n- Slow upload (throttled bandwidth)\n- Intermittent drops mid-upload\n- High latency connections  \n- Timeout scenarios\n- Connection loss during multipart upload\n- Retry behavior on transient failures\n\nContext: Issue #2198 specifically mentions 'poor internet connection' causing upload errors. Current code has no retry logic and relies on URLSession defaults for timeouts.\n\nRelated GitHub issues: #3484, #2198, #1286","created_at":"2026-01-03T18:44:35Z"}]}
{"id":"damus-n3q","title":"Squash PR commits into logically distinct structure per damus guidelines","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T17:37:18.995347-06:00","created_by":"e","updated_at":"2026-01-03T18:04:33.758361-06:00","closed_at":"2026-01-03T18:04:33.758361-06:00","close_reason":"fixed"}
{"id":"damus-r77","title":"Investigate iOS 18 security scoped resource and CGImageSource compatibility","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:45:04.987609-06:00","created_by":"e","updated_at":"2026-01-03T14:15:53.176254-06:00","closed_at":"2026-01-03T14:15:53.176257-06:00","labels":["bug","ios18","media"],"dependencies":[{"issue_id":"damus-r77","depends_on_id":"damus-63x","type":"relates-to","created_at":"2026-01-03T12:45:45.345098-06:00","created_by":"daemon"},{"issue_id":"damus-r77","depends_on_id":"damus-0pj","type":"parent-child","created_at":"2026-01-03T12:47:07.210882-06:00","created_by":"daemon"}],"comments":[{"id":8,"issue_id":"damus-r77","author":"e","text":"GitHub issue #3484 reports failures on iOS 18.7 specifically. Potential iOS 18 breaking changes:\n\n1. startAccessingSecurityScopedResource() behavior (MediaPicker.swift:136)\n2. CGImageSourceCreateWithData/URL operations (ImageProcessing.swift)\n3. PHPickerViewController changes\n4. Stricter sandboxing for temp file access\n\nNeed to test on iOS 18 device and check Apple release notes for breaking changes.\n\nFiles: MediaPicker.swift, ImageProcessing.swift","created_at":"2026-01-03T18:45:31Z"},{"id":9,"issue_id":"damus-r77","author":"e","text":"## iOS 18 Investigation Findings\n\n### Key Issue Found: CGImageDestinationAddImageFromSource Bug\n\nThe codebase uses `CGImageDestinationAddImageFromSource` in `ImageProcessing.swift:147` which has known issues in iOS 18/macOS 15.\n\n**Symptoms reported by developers:**\n- Console errors: `bad image size (0 x 0)`\n- `CGImageSourceCreateThumbnailAtIndex - 'HJPG' - failed to create thumbnail [-67]`\n- Crashes in `CGImageDestinationFinalize`\n- HEIC images from iOS 18 devices have 'corrupt header' issues\n\n**Root cause:** iOS 18 changes to Image I/O framework affecting HEIC/JPEG transcoding and thumbnail generation.\n\n**Files affected in damus:**\n- `ImageProcessing.swift` - uses `CGImageDestinationAddImageFromSource` (line 147)\n- `MediaPicker.swift` - uses `startAccessingSecurityScopedResource` (line 214)\n\n**Known workaround:** Use `CGImageSourceCreateImageAtIndex` + `CGImageSourceCopyPropertiesAtIndex` + `CGImageDestinationAddImage` instead of `CGImageDestinationAddImageFromSource`\n\n### Sources\n- Apple Developer Forums thread 769659\n- Apple Developer Forums thread 768446  \n- Immich GitHub issue #10464","created_at":"2026-01-03T20:04:45Z"},{"id":10,"issue_id":"damus-r77","author":"e","text":"## Recommendations\n\n### Immediate Fix: Replace CGImageDestinationAddImageFromSource\n\nIn `ImageProcessing.swift`, replace the problematic API call with the workaround:\n\n**Current code (line 146-148):**\n```swift\nfor i in 0..\u003ctotalCount {\n    CGImageDestinationAddImageFromSource(destination, source, i, removeGPSProperties)\n}\n```\n\n**Recommended fix:**\n```swift\nfor i in 0..\u003ctotalCount {\n    guard let image = CGImageSourceCreateImageAtIndex(source, i, nil),\n          let properties = CGImageSourceCopyPropertiesAtIndex(source, i, nil) else {\n        continue\n    }\n    // Merge GPS removal with existing properties\n    let mutableProps = NSMutableDictionary(dictionary: properties)\n    mutableProps[kCGImagePropertyGPSDictionary] = kCFNull\n    CGImageDestinationAddImage(destination, image, mutableProps as CFDictionary)\n}\n```\n\n### Why This Helps\n1. Avoids the iOS 18 bug in `CGImageDestinationAddImageFromSource`\n2. Explicit image/properties extraction is more reliable\n3. Works across iOS 17 and iOS 18\n\n### Additional Considerations\n1. **HEIC from camera**: CameraService.swift captures HEVC/HEIF - these images go through the same processing path\n2. **Error handling**: Current code silently returns nil on failure - the new debug logging will help diagnose\n3. **Testing needed**: Test with HEIC images from iOS 18 devices specifically","created_at":"2026-01-03T20:05:45Z"},{"id":11,"issue_id":"damus-r77","author":"e","text":"## Resolution\n\nFixed in commit 4ffdb38a - 'Fix iOS 18 image processing crash with HEIC images'\n\nThe fix replaces the problematic `CGImageDestinationAddImageFromSource` API with explicit image extraction using `CGImageSourceCreateImageAtIndex` + `CGImageDestinationAddImage`.","created_at":"2026-01-03T20:15:58Z"}]}
{"id":"damus-rbn","title":"Add retry logic for transient upload failures","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:45:05.172501-06:00","created_by":"e","updated_at":"2026-01-03T13:07:51.015763-06:00","closed_at":"2026-01-03T13:07:51.015763-06:00","close_reason":"Closed","labels":["enhancement","media","network"],"dependencies":[{"issue_id":"damus-rbn","depends_on_id":"damus-0pj","type":"parent-child","created_at":"2026-01-03T12:47:07.212451-06:00","created_by":"daemon"}],"comments":[{"id":12,"issue_id":"damus-rbn","author":"e","text":"Current upload code has no retry logic - any transient failure shows error immediately.\n\nAdd:\n- Configurable retry count (e.g., 3 attempts)\n- Exponential backoff between retries\n- Only retry on transient errors (network timeout, 5xx responses)\n- Don't retry on permanent errors (4xx, file too large)\n\nFiles: ImageUploadModel.swift, AttachMediaUtility.swift","created_at":"2026-01-03T18:45:31Z"},{"id":13,"issue_id":"damus-rbn","author":"e","text":"Analysis of current network interruption behavior:\n\n**What happens when connection drops mid-upload:**\n- 1 second drop: TCP connection might survive (unlikely). Usually fails with NSURLErrorNetworkConnectionLost\n- 10 second drop: Connection dead. Fails immediately with network error.\n\n**Current code has NO retry logic:**\n- URLSession.shared.data() is called once\n- Any failure immediately returns .failed(error)\n- User must manually retry\n\n**Recommended implementation:**\n- Wrap upload in retry loop (3 attempts)\n- Use exponential backoff: 1s, 2s, 4s delays\n- Only retry on transient errors:\n  - NSURLErrorNetworkConnectionLost\n  - NSURLErrorTimedOut  \n  - NSURLErrorNotConnectedToInternet (if reconnects)\n  - HTTP 5xx responses\n- Don't retry on:\n  - HTTP 4xx (client error)\n  - File read errors\n  - Server error responses (file too large, etc)\n\n**Consider:** iOS background URLSession for large uploads that survive app backgrounding","created_at":"2026-01-03T18:50:38Z"},{"id":14,"issue_id":"damus-rbn","author":"e","text":"## Implementation Complete\n\n### Changes Made:\n\n**1. MediaUploader.swift - Added `isRetryable` property to UploadError**\nRetryable errors:\n- `NSURLErrorTimedOut`\n- `NSURLErrorCannotConnectToHost`\n- `NSURLErrorNetworkConnectionLost`\n- `NSURLErrorNotConnectedToInternet`\n- `NSURLErrorDNSLookupFailed`\n- `jsonParsingFailed` (could be transient server issue)\n- `missingURL` (could be transient)\n\nNon-retryable:\n- `serverError` (explicit rejection like \"file too large\")\n- `fileReadError` (local file issue)\n- `invalidAPIURL` (configuration issue)\n- `noMediaData` (local issue)\n\n**2. AttachMediaUtility.swift - Added retry logic**\n- Added `UploadRetryConfig` struct with `maxRetries` and `baseDelaySeconds`\n- Default: 2 retries with 1s base delay (1s, 2s exponential backoff)\n- Added `executeWithRetry()` method that wraps single upload attempts\n- Added `executeSingleUpload()` for single attempt logic\n- Logs retry attempts and final outcome\n\n### Behavior:\n- First attempt fails with network timeout\n- Wait 1 second, retry\n- Second attempt fails with connection lost  \n- Wait 2 seconds, retry\n- Third attempt succeeds or fails permanently\n\n### Backwards Compatible:\n- `retryConfig` parameter has default value\n- Existing callers continue to work unchanged\n- Can pass `UploadRetryConfig.none` to disable retries","created_at":"2026-01-03T19:07:46Z"}]}
{"id":"damus-tah","title":"Fix error message truncation on small screens in PostView","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:45:04.81935-06:00","created_by":"e","updated_at":"2026-01-03T12:57:49.842567-06:00","closed_at":"2026-01-03T12:57:49.842567-06:00","close_reason":"Closed","labels":["bug","media","ui"],"dependencies":[{"issue_id":"damus-tah","depends_on_id":"damus-63x","type":"relates-to","created_at":"2026-01-03T12:45:45.300088-06:00","created_by":"daemon"},{"issue_id":"damus-tah","depends_on_id":"damus-0pj","type":"parent-child","created_at":"2026-01-03T12:47:07.209162-06:00","created_by":"daemon"}],"comments":[{"id":15,"issue_id":"damus-tah","author":"e","text":"GitHub issue #2198 reports error messages are cut off on small phone screens when upload fails on poor connections.\n\nFix: In PostView.swift error display, allow multiline text:\n- Add .lineLimit(nil)\n- Add .fixedSize(horizontal: false, vertical: true)\n\nFiles: PostView.swift (around line 323-326)","created_at":"2026-01-03T18:45:31Z"},{"id":16,"issue_id":"damus-tah","author":"e","text":"## Implementation Complete\n\n### Changes Made:\n\n**1. PostView.swift (line 323-330)**\nError text now has:\n- `.font(.caption)` - smaller font to fit more text\n- `.lineLimit(3)` - allow up to 3 lines\n- `.minimumScaleFactor(0.8)` - scale down if needed\n- `.fixedSize(horizontal: false, vertical: true)` - prevent horizontal truncation\n\n**2. EditPictureControl.swift (line 109-125)**\nError sheet redesigned:\n- Added \"Upload Failed\" header\n- Error message with `.multilineTextAlignment(.center)`\n- `.fixedSize(horizontal: false, vertical: true)` for full message\n- Added \"OK\" dismiss button\n- Set `.presentationDetents([.height(200)])` for consistent height\n\n### Before vs After:\n\n**PostView Before:** Single line, truncated on small screens\n**PostView After:** Up to 3 lines, scales to fit\n\n**EditPictureControl Before:** Plain text, no formatting\n**EditPictureControl After:** Proper error dialog with title, message, and button","created_at":"2026-01-03T18:57:45Z"}]}
{"id":"damus-uya","title":"Add error handling for Stage 1 media selection/processing failures","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:45:04.897233-06:00","created_by":"e","updated_at":"2026-01-03T13:05:01.793226-06:00","closed_at":"2026-01-03T13:05:01.793226-06:00","close_reason":"Closed","labels":["bug","error-handling","media"],"dependencies":[{"issue_id":"damus-uya","depends_on_id":"damus-63x","type":"relates-to","created_at":"2026-01-03T12:45:45.323086-06:00","created_by":"daemon"},{"issue_id":"damus-uya","depends_on_id":"damus-0pj","type":"parent-child","created_at":"2026-01-03T12:47:07.210061-06:00","created_by":"daemon"}],"comments":[{"id":17,"issue_id":"damus-uya","author":"e","text":"In MediaPicker.swift and ImageProcessing.swift, multiple failure points silently return without notifying user:\n- guard let url = item as? URL else { return } (line 61)\n- guard let newUrl = fallback(url) else { return } (line 142)\n- guard let imageData = try? Data(contentsOf: url) else { return nil } (ImageProcessing.swift:13)\n\nUser gets no feedback when media selection/processing fails - image just doesn't appear.\n\nFix: Add error callbacks or state to surface these failures to UI.\n\nFiles: MediaPicker.swift, ImageProcessing.swift, PostView.swift","created_at":"2026-01-03T18:45:31Z"},{"id":18,"issue_id":"damus-uya","author":"e","text":"## Implementation Complete\n\n### Changes Made:\n\n**1. MediaPicker.swift**\n- Added `MediaPickerError` struct for error info\n- Added `onError: ((Int) -\u003e Void)?` callback parameter\n- Added `failedCount` tracking in Coordinator  \n- Added `recordFailure()` helper method\n- All failure points now call `recordFailure()` instead of just `dispatchGroup.leave()`\n- `dispatchGroup.notify` now calls `onError` with failure count if any failures occurred\n\n**2. PostView.swift**\n- Added `onError` callback to MediaPicker\n- Shows localized error message: \"Failed to process N items\"\n- Uses existing `error` state to display message\n\n**3. EditPictureControl.swift**\n- Added `onError` callback to MediaPicker  \n- Shows \"Failed to process the selected image\" via existing `failed()` method\n\n### User Experience:\n\n**Before:** Media silently didn't appear when processing failed\n**After:** User sees \"Failed to process 2 items\" (or similar) in red text\n\n### Backwards Compatible:\n`onError` callback is optional - existing code continues to work without changes.","created_at":"2026-01-03T19:04:55Z"}]}
{"id":"damus-w2w","title":"LOW: Commit 61a4ff34 mixes .gitignore edit with crash fix - violates one logical change per commit","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-03T17:22:49.127193-06:00","created_by":"e","updated_at":"2026-01-03T18:04:38.935403-06:00","closed_at":"2026-01-03T18:04:38.935403-06:00","close_reason":"fixed"}
