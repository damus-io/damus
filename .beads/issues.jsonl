{"id":"damus-0o0","title":"Support animated GIF custom emojis (NIP-30)","description":"Current implementation renders GIF custom emojis as static first-frame images. SwiftUI Text(Image(uiImage:)) doesn't support animation, and scaleEmojiImage() strips animation data. To support animated GIFs would require replacing inline Text(Image()) rendering with a custom AnimatedImage view approach, which is a significant architectural change to the text flow model.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-13T16:51:23.170841-06:00","created_by":"e","updated_at":"2026-01-13T16:51:23.170841-06:00"}
{"id":"damus-0zg","title":"Render custom emoji in kind 0 profiles","description":"Apply emojify to profile name and about fields per NIP-30.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T10:08:33.587467-06:00","created_by":"e","updated_at":"2026-01-13T11:14:17.975635-06:00","closed_at":"2026-01-13T11:14:17.975637-06:00","dependencies":[{"issue_id":"damus-0zg","depends_on_id":"damus-105","type":"blocks","created_at":"2026-01-13T10:08:45.551895-06:00","created_by":"daemon"}]}
{"id":"damus-105","title":"Create emojify function for content rendering","description":"Replace :shortcode: patterns in text with inline images. Must handle multiple emoji per string. Should return attributed string or SwiftUI view.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T10:08:33.218127-06:00","created_by":"e","updated_at":"2026-01-13T11:03:25.729746-06:00","closed_at":"2026-01-13T11:03:25.729746-06:00","close_reason":"Implemented emojify_text function in Hashtags.swift with image caching support. Integrated into render_blocks. 11 tests passing.","dependencies":[{"issue_id":"damus-105","depends_on_id":"damus-95z","type":"blocks","created_at":"2026-01-13T10:08:45.503653-06:00","created_by":"daemon"}]}
{"id":"damus-233","title":"Custom emoji re-render blocked by existing artifacts","description":"preload_event only re-rendered if artifacts was nil, but artifacts already existed with purple fallback, so forced re-render after image load never happened","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-13T16:43:43.752217-06:00","created_by":"e","updated_at":"2026-01-13T16:43:48.54487-06:00","closed_at":"2026-01-13T16:43:48.54487-06:00","close_reason":"Changed condition from 'artifacts == nil \u0026\u0026 load_artifacts' to 'artifacts == nil || load_artifacts'"}
{"id":"damus-2d8","title":"NIP-30 Custom Emoji Support","description":"Track implementation of custom emoji rendering per NIP-30 spec. Users should see custom emoji rendered as images when viewing posts containing :shortcode: syntax with corresponding emoji tags. Related: github.com/damus-io/damus/issues/2003","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-13T10:08:22.375812-06:00","created_by":"e","updated_at":"2026-01-13T16:27:34.268859-06:00","closed_at":"2026-01-13T16:27:34.268859-06:00","close_reason":"NIP-30 custom emoji support complete - view rendering and compose support implemented","dependencies":[{"issue_id":"damus-2d8","depends_on_id":"damus-95z","type":"blocks","created_at":"2026-01-13T10:08:45.346413-06:00","created_by":"daemon"},{"issue_id":"damus-2d8","depends_on_id":"damus-105","type":"blocks","created_at":"2026-01-13T10:08:45.372997-06:00","created_by":"daemon"},{"issue_id":"damus-2d8","depends_on_id":"damus-aoz","type":"blocks","created_at":"2026-01-13T10:08:45.399406-06:00","created_by":"daemon"},{"issue_id":"damus-2d8","depends_on_id":"damus-0zg","type":"blocks","created_at":"2026-01-13T10:08:45.427562-06:00","created_by":"daemon"},{"issue_id":"damus-2d8","depends_on_id":"damus-3gl","type":"blocks","created_at":"2026-01-13T10:08:45.454277-06:00","created_by":"daemon"}]}
{"id":"damus-2d8.1","title":"Render color emojis per NIP-30 in performant manner","description":"## Primary Objective ✓ COMPLETED\nRender custom emoji IMAGES inline in note text per NIP-30 spec.\n\n## Root Cause\nImages were cached on DISK but not in MEMORY. `isCached()` returns true for disk cache, but `retrieveImageInMemoryCache()` only checks memory cache.\n\n## Fix\nModified `prefetchCustomEmojisAndReload()` to:\n1. Check both memory AND disk cache status separately\n2. If image is on disk but not in memory, explicitly load it into memory via `ImageCache.default.retrieveImage()` + `store(toDisk: false)`\n3. Then trigger re-render with `load(force_artifacts: true)`\n\n## Files Modified\n- `NoteContentView.swift` - disk-to-memory cache loading\n- `Hashtags.swift` - `render_custom_emoji()` returns `.imageIcon` for cached images\n- `CompatibleAttribute.swift` - `.imageIcon(UIImage, offset)` case for inline image rendering\n\n## Architecture\n1. On view appear, `prefetchCustomEmojisAndReload()` runs async\n2. Checks each emoji: inMemory vs onDisk\n3. Loads disk→memory if needed, downloads if not on disk\n4. Triggers `load(force_artifacts: true)` to re-render\n5. `render_custom_emoji()` finds image in memory cache\n6. Returns `.imageIcon(UIImage)` which renders via `Text(Image(uiImage:))`","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-13T14:19:20.091182-06:00","created_by":"e","updated_at":"2026-01-13T16:09:02.21839-06:00","closed_at":"2026-01-13T16:09:02.218394-06:00","dependencies":[{"issue_id":"damus-2d8.1","depends_on_id":"damus-2d8","type":"parent-child","created_at":"2026-01-13T14:19:20.091601-06:00","created_by":"daemon"}]}
{"id":"damus-2d8.2","title":"Add custom emoji compose support in PostView","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T16:19:26.547071-06:00","created_by":"e","updated_at":"2026-01-13T16:27:23.875573-06:00","closed_at":"2026-01-13T16:27:23.875573-06:00","close_reason":"Full compose support implemented","dependencies":[{"issue_id":"damus-2d8.2","depends_on_id":"damus-2d8","type":"parent-child","created_at":"2026-01-13T16:19:26.547508-06:00","created_by":"daemon"}]}
{"id":"damus-2d8.2.1","title":"Create CustomEmojiStore for tracking known emojis","description":"Create a store to track custom emojis the user has seen or wants to use during compose","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T16:19:33.042347-06:00","created_by":"e","updated_at":"2026-01-13T16:27:23.767125-06:00","closed_at":"2026-01-13T16:27:23.767125-06:00","close_reason":"Added CustomEmojiStore class to track emojis seen from timeline","dependencies":[{"issue_id":"damus-2d8.2.1","depends_on_id":"damus-2d8.2","type":"parent-child","created_at":"2026-01-13T16:19:33.04397-06:00","created_by":"daemon"}]}
{"id":"damus-2d8.2.2","title":"Create CustomEmojiPickerView UI component","description":"UI component for browsing and selecting custom emojis during compose","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T16:19:33.081563-06:00","created_by":"e","updated_at":"2026-01-13T16:27:23.79683-06:00","closed_at":"2026-01-13T16:27:23.79683-06:00","close_reason":"Added CustomEmojiPickerView for browsing and selecting custom emojis","dependencies":[{"issue_id":"damus-2d8.2.2","depends_on_id":"damus-2d8.2","type":"parent-child","created_at":"2026-01-13T16:19:33.081994-06:00","created_by":"daemon"}]}
{"id":"damus-2d8.2.3","title":"Integrate emoji picker into PostView","description":"Add emoji button to AttachmentBar, state for tracking selected emojis, and insertion logic","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T16:19:33.119623-06:00","created_by":"e","updated_at":"2026-01-13T16:27:23.824321-06:00","closed_at":"2026-01-13T16:27:23.824321-06:00","close_reason":"Added emoji button to AttachmentBar and insertCustomEmoji function in PostView","dependencies":[{"issue_id":"damus-2d8.2.3","depends_on_id":"damus-2d8.2","type":"parent-child","created_at":"2026-01-13T16:19:33.120001-06:00","created_by":"daemon"}]}
{"id":"damus-2d8.2.4","title":"Add emoji tags in build_post function","description":"Parse content for :shortcode: patterns and add emoji tags to the NostrPost","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T16:19:33.155577-06:00","created_by":"e","updated_at":"2026-01-13T16:27:23.850318-06:00","closed_at":"2026-01-13T16:27:23.850318-06:00","close_reason":"Added emoji tags to build_post function for NIP-30 compliance","dependencies":[{"issue_id":"damus-2d8.2.4","depends_on_id":"damus-2d8.2","type":"parent-child","created_at":"2026-01-13T16:19:33.155974-06:00","created_by":"daemon"}]}
{"id":"damus-3gl","title":"Render custom emoji in kind 7 reactions","description":"Apply emojify to reaction content per NIP-30.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T10:08:33.7592-06:00","created_by":"e","updated_at":"2026-01-13T11:14:18.002251-06:00","closed_at":"2026-01-13T11:14:18.002253-06:00","dependencies":[{"issue_id":"damus-3gl","depends_on_id":"damus-105","type":"blocks","created_at":"2026-01-13T10:08:45.575464-06:00","created_by":"daemon"}]}
{"id":"damus-95z","title":"Parse emoji tags from NostrEvent","description":"Extract emoji tags from event tags array. Each emoji tag is [\"emoji\", shortcode, image-url]. Store as accessible data structure.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T10:08:33.022888-06:00","created_by":"e","updated_at":"2026-01-13T10:30:29.955902-06:00","closed_at":"2026-01-13T10:30:29.955902-06:00","close_reason":"Implemented CustomEmoji struct in Id.swift and added referenced_custom_emojis to NdbNote extension. Tests passing."}
{"id":"damus-aoz","title":"Render custom emoji in kind 1 notes","description":"Apply emojify to note content. Custom emoji should display inline with text at appropriate size.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T10:08:33.407473-06:00","created_by":"e","updated_at":"2026-01-13T11:03:39.87937-06:00","closed_at":"2026-01-13T11:03:39.87937-06:00","close_reason":"Kind 1 notes now render custom emoji via emojify_text integration in render_blocks. Text blocks containing :shortcode: patterns are automatically processed and replaced with styled text (or cached images when available).","dependencies":[{"issue_id":"damus-aoz","depends_on_id":"damus-105","type":"blocks","created_at":"2026-01-13T10:08:45.527565-06:00","created_by":"daemon"}]}
{"id":"damus-iro","title":"Custom emoji not rendering after download","description":"Downloaded emoji images weren't being loaded into memory after prefetching, causing purple fallback to persist","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-13T16:31:54.874167-06:00","created_by":"e","updated_at":"2026-01-13T16:31:54.926799-06:00","closed_at":"2026-01-13T16:31:54.926799-06:00","close_reason":"Fixed by loading downloaded images into memory cache after prefetch completes"}
{"id":"damus-upl","title":"Custom emoji upload - allow users to upload their own custom emojis","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-13T17:54:18.567549-06:00","created_by":"e","updated_at":"2026-01-13T18:05:08.270795-06:00","closed_at":"2026-01-13T18:05:08.270795-06:00","close_reason":"All subtasks completed - custom emoji upload feature implemented"}
{"id":"damus-upl.1","title":"Add CustomEmojiSettingsView - settings page to manage emojis","description":"Create settings page with list of saved emojis, add button, delete capability","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T17:54:32.100469-06:00","created_by":"e","updated_at":"2026-01-13T18:05:02.503915-06:00","closed_at":"2026-01-13T18:05:02.503915-06:00","close_reason":"Created CustomEmojiSettingsView with emoji list, add button, delete capability","dependencies":[{"issue_id":"damus-upl.1","depends_on_id":"damus-upl","type":"parent-child","created_at":"2026-01-13T17:54:32.102327-06:00","created_by":"daemon"}]}
{"id":"damus-upl.2","title":"Add AddCustomEmojiView - upload flow with image picker and shortcode entry","description":"Modal view: select image from library/camera, enter shortcode, preview, upload","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T17:54:36.612345-06:00","created_by":"e","updated_at":"2026-01-13T18:05:02.563798-06:00","closed_at":"2026-01-13T18:05:02.563798-06:00","close_reason":"Created AddCustomEmojiView with image picker, shortcode entry, upload flow","dependencies":[{"issue_id":"damus-upl.2","depends_on_id":"damus-upl","type":"parent-child","created_at":"2026-01-13T17:54:36.613851-06:00","created_by":"daemon"}]}
{"id":"damus-upl.3","title":"Add shortcode validation (lowercase, 2-32 chars, alphanumeric + underscore)","description":"Validate shortcode format: [a-z0-9_]+, 2-32 chars, no leading/trailing underscores","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T17:54:41.18091-06:00","created_by":"e","updated_at":"2026-01-13T18:05:02.624422-06:00","closed_at":"2026-01-13T18:05:02.624422-06:00","close_reason":"Added isValidShortcode and sanitizeShortcode functions","dependencies":[{"issue_id":"damus-upl.3","depends_on_id":"damus-upl","type":"parent-child","created_at":"2026-01-13T17:54:41.182398-06:00","created_by":"daemon"}]}
{"id":"damus-upl.4","title":"Resize uploaded images to 128x128 before upload","description":"Scale images to 128x128 to keep emoji file sizes small and consistent","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T17:54:45.73862-06:00","created_by":"e","updated_at":"2026-01-13T18:05:02.685863-06:00","closed_at":"2026-01-13T18:05:02.685863-06:00","close_reason":"Added resizeImage function to scale to 128x128","dependencies":[{"issue_id":"damus-upl.4","depends_on_id":"damus-upl","type":"parent-child","created_at":"2026-01-13T17:54:45.740182-06:00","created_by":"daemon"}]}
{"id":"damus-upl.5","title":"Upload image to media server using default uploader (with optional override)","description":"Use user's default MediaUploader setting, allow optional per-upload override. Reuse AttachMediaUtility.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T17:54:51.129166-06:00","created_by":"e","updated_at":"2026-01-13T18:05:02.746985-06:00","closed_at":"2026-01-13T18:05:02.746985-06:00","close_reason":"Integrated AttachMediaUtility for upload with progress tracking","dependencies":[{"issue_id":"damus-upl.5","depends_on_id":"damus-upl","type":"parent-child","created_at":"2026-01-13T17:54:51.13094-06:00","created_by":"daemon"}]}
{"id":"damus-upl.6","title":"Add uploaded emoji to CustomEmojiStore and publish kind 10030 event","description":"After successful upload, create CustomEmoji with shortcode+URL, save to store, publish updated emoji list","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T17:54:56.163596-06:00","created_by":"e","updated_at":"2026-01-13T18:05:02.806754-06:00","closed_at":"2026-01-13T18:05:02.806754-06:00","close_reason":"Added saveEmoji and publishEmojiList to store and publish kind 10030","dependencies":[{"issue_id":"damus-upl.6","depends_on_id":"damus-upl","type":"parent-child","created_at":"2026-01-13T17:54:56.165226-06:00","created_by":"daemon"}]}
{"id":"damus-upl.7","title":"Add route and navigation link in ConfigView for CustomEmojiSettings","description":"Add Route.CustomEmojiSettings case in Router.swift, add navigation link in ConfigView.swift","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T17:55:01.078599-06:00","created_by":"e","updated_at":"2026-01-13T18:05:02.441238-06:00","closed_at":"2026-01-13T18:05:02.441238-06:00","close_reason":"Added Route.CustomEmojiSettings and navigation link in ConfigView","dependencies":[{"issue_id":"damus-upl.7","depends_on_id":"damus-upl","type":"parent-child","created_at":"2026-01-13T17:55:01.081043-06:00","created_by":"daemon"}]}
{"id":"damus-yos","title":"NIP-30 emoji lists (kind 10030) - personal emoji collections","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-13T17:11:00.948673-06:00","created_by":"e","updated_at":"2026-01-13T17:19:24.408932-06:00","closed_at":"2026-01-13T17:19:24.408932-06:00","close_reason":"Closed"}
{"id":"damus-yos.1","title":"Define EmojiList model and kind 10030 event structure","description":"Create Swift model for emoji list that maps to kind 10030 replaceable event with emoji tags","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T17:11:05.928706-06:00","created_by":"e","updated_at":"2026-01-13T17:19:14.950871-06:00","closed_at":"2026-01-13T17:19:14.950871-06:00","close_reason":"Closed","dependencies":[{"issue_id":"damus-yos.1","depends_on_id":"damus-yos","type":"parent-child","created_at":"2026-01-13T17:11:05.930528-06:00","created_by":"daemon"}]}
{"id":"damus-yos.2","title":"Fetch user's kind 10030 emoji list on app start","description":"Subscribe to user's kind 10030 event and populate CustomEmojiStore with saved emojis","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T17:11:29.922453-06:00","created_by":"e","updated_at":"2026-01-13T17:19:14.952198-06:00","closed_at":"2026-01-13T17:19:14.952198-06:00","close_reason":"Closed","dependencies":[{"issue_id":"damus-yos.2","depends_on_id":"damus-yos","type":"parent-child","created_at":"2026-01-13T17:11:29.924168-06:00","created_by":"daemon"}]}
{"id":"damus-yos.3","title":"Add 'Save emoji' action in note content view","description":"Long-press or context menu on custom emoji to save it to user's personal list","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T17:11:29.972809-06:00","created_by":"e","updated_at":"2026-01-13T17:19:14.953211-06:00","closed_at":"2026-01-13T17:19:14.953211-06:00","close_reason":"Closed","dependencies":[{"issue_id":"damus-yos.3","depends_on_id":"damus-yos","type":"parent-child","created_at":"2026-01-13T17:11:29.973271-06:00","created_by":"daemon"}]}
{"id":"damus-yos.4","title":"Publish kind 10030 event when user saves/removes emoji","description":"Sign and publish updated emoji list to relays when user modifies their collection","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T17:11:30.020121-06:00","created_by":"e","updated_at":"2026-01-13T17:19:14.954049-06:00","closed_at":"2026-01-13T17:19:14.954049-06:00","close_reason":"Closed","dependencies":[{"issue_id":"damus-yos.4","depends_on_id":"damus-yos","type":"parent-child","created_at":"2026-01-13T17:11:30.020563-06:00","created_by":"daemon"}]}
{"id":"damus-yos.5","title":"Show 'My Emojis' section in compose emoji picker","description":"Add tab or section in CustomEmojiPickerView showing saved emojis from kind 10030","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T17:11:30.059781-06:00","created_by":"e","updated_at":"2026-01-13T17:19:14.954964-06:00","closed_at":"2026-01-13T17:19:14.954964-06:00","close_reason":"Closed","dependencies":[{"issue_id":"damus-yos.5","depends_on_id":"damus-yos","type":"parent-child","created_at":"2026-01-13T17:11:30.060174-06:00","created_by":"daemon"}]}
{"id":"damus-yos.6","title":"Settings UI to manage emoji collection","description":"View and remove emojis from personal collection in Settings","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T17:11:30.097637-06:00","created_by":"e","updated_at":"2026-01-13T17:55:09.891308-06:00","closed_at":"2026-01-13T17:55:09.891308-06:00","close_reason":"Superseded by damus-upl epic which includes settings UI with upload capability","dependencies":[{"issue_id":"damus-yos.6","depends_on_id":"damus-yos","type":"parent-child","created_at":"2026-01-13T17:11:30.098041-06:00","created_by":"daemon"}]}
